<app-login-layout
    [title]="'Nova Senha'"
    [primaryBtnText]="buttonText"
    (submit)="submit()"
    [disablePrimaryBtn]="!resetPasswordForm.valid || loading"
>
    <img
        src="/top2.png"
        alt="TOP Construtora"
        class="login-logo"
    />
    
    <form [formGroup]="resetPasswordForm">
        <!-- Código de recuperação -->
        <div class="form-group">
            <label for="code">Código de Recuperação</label>
            <div class="code-input-wrapper">
                <input
                    id="code"
                    type="text"
                    formControlName="code"
                    class="form-control code-input"
                    placeholder="Digite o código de 6 dígitos"
                    maxlength="6"
                    [class.is-invalid]="resetPasswordForm.get('code')?.invalid && resetPasswordForm.get('code')?.touched"
                    (input)="onCodeInput($event)"
                    (keypress)="onKeyPress($event)"
                />
                <div class="code-icon">
                    <i class="fas fa-key"></i>
                </div>
            </div>
            <div class="invalid-feedback" *ngIf="resetPasswordForm.get('code')?.invalid && resetPasswordForm.get('code')?.touched">
                {{ getErrorMessage('code') }}
            </div>
        </div>

        <!-- Nova senha -->
        <div class="form-group">
            <label for="password">Nova Senha</label>
            <div class="password-input-wrapper">
                <input
                    id="password"
                    [type]="showPassword ? 'text' : 'password'"
                    formControlName="password"
                    class="form-control"
                    placeholder="Digite sua nova senha"
                    [class.is-invalid]="resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched"
                    (keypress)="onKeyPress($event)"
                />
                <button
                    type="button"
                    class="toggle-password"
                    (click)="togglePasswordVisibility('password')"
                >
                    <i class="fas" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                </button>
            </div>
            <div class="invalid-feedback" *ngIf="resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched">
                {{ getErrorMessage('password') }}
            </div>
        </div>

        <!-- Confirmar senha -->
        <div class="form-group">
            <label for="confirmPassword">Confirmar Nova Senha</label>
            <div class="password-input-wrapper">
                <input
                    id="confirmPassword"
                    [type]="showConfirmPassword ? 'text' : 'password'"
                    formControlName="confirmPassword"
                    class="form-control"
                    placeholder="Confirme sua nova senha"
                    [class.is-invalid]="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched"
                    (keypress)="onKeyPress($event)"
                />
                <button
                    type="button"
                    class="toggle-password"
                    (click)="togglePasswordVisibility('confirmPassword')"
                >
                    <i class="fas" [ngClass]="showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                </button>
            </div>
            <div class="invalid-feedback" *ngIf="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched">
                {{ getErrorMessage('confirmPassword') }}
            </div>
        </div>

        <!-- Requisitos de senha -->
        <div class="password-requirements">
            <p class="requirements-title">A senha deve conter:</p>
            <ul>
                <li [class.valid]="hasMinLength()">
                    <i class="fas fa-check-circle"></i> Mínimo de 8 caracteres
                </li>
                <li [class.valid]="hasLowercase()">
                    <i class="fas fa-check-circle"></i> Letra minúscula
                </li>
                <li [class.valid]="hasUppercase()">
                    <i class="fas fa-check-circle"></i> Letra maiúscula
                </li>
                <li [class.valid]="hasNumber()">
                    <i class="fas fa-check-circle"></i> Número
                </li>
                <li [class.valid]="hasSpecialChar()">
                    <i class="fas fa-check-circle"></i> Caractere especial (&#64;$!%*?&)
                </li>
                <li [class.valid]="passwordsMatch()">
                    <i class="fas fa-check-circle"></i> Confirmação de senha igual
                </li>
            </ul>
        </div>

        <!-- Links auxiliares -->
        <div class="helper-links">
            <a routerLink="/forgot-password" class="link">
                <i class="fas fa-envelope"></i> Reenviar código
            </a>
            <a routerLink="/login" class="link">
                <i class="fas fa-arrow-left"></i> Voltar ao login
            </a>
        </div>
    </form>

    <!-- Mensagem de erro -->
    <div class="error-message" *ngIf="error">
        <i class="fas fa-exclamation-circle"></i>
        {{ error }}
    </div>
</app-login-layout>